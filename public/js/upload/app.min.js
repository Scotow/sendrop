$(function(){var e=$("body"),a=$("form"),t=$(".icon"),n=$("#file-name"),o=$("input[type=file]"),r=$("#pretty"),d=$("input[type=submit]"),i=!1,s=Cookies.get("pretty"),l=void 0===s?1:parseInt(s);r.prop("checked",l).change(function(){l=this.checked?1:0,Cookies.set("pretty",l,{expires:365})}),a.submit(function(e){i=!0,t.addClass("floating uploading"),n.text(""),d.addClass("hidden"),o.click(function(){return!1})}),o.on("change",function(){var e;switch(this.files.length){case 0:e="";break;case 1:e=this.files[0].name;break;default:e=this.files.length+" files selected"}i=!!e,e?(t.removeClass("floating"),n.text(e),d.removeClass("hidden")):(t.addClass("floating"),n.text(""),d.addClass("hidden"))}),e.on("drag dragstart dragend dragover dragenter dragleave drop",function(e){e.preventDefault(),e.stopPropagation()}).on("dragover dragenter",function(){i||e.addClass("dragging")}).on("dragleave dragend drop",function(){i||e.removeClass("dragging")}).on("drop",function(r){if(!i){i=r.originalEvent.dataTransfer.files;for(var s=new FormData,c=0;c<i.length;c++)s.append("files",i[c]);t.addClass("floating uploading"),n.text(""),d.addClass("hidden"),o.click(function(){return!1}),$.ajax({url:a.attr("action"),type:a.attr("method"),data:s,dataType:"text",cache:!1,contentType:!1,processData:!1,success:function(a){i=!1,o.off("click"),t.removeClass("uploading");var n=$("<form>",{method:"POST",action:"/"});$("<input>",{type:"hidden",name:"drop",value:a}).appendTo(n),$("<input>",{type:"hidden",name:"pretty",value:l}).appendTo(n),n.appendTo(e).submit()},error:function(){i=!1,o.off("click"),t.removeClass("uploading").addClass("error"),setTimeout(function(){t.removeClass("error")},2e3)}})}})});
