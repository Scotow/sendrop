$(function(){var f=$("body"),h=$("form"),d=$(".icon"),c=$("#file-name"),e=$("input[type=file]"),n=$("#pretty"),g=$("input[type=submit]"),b=!1,m=Cookies.get("pretty"),k=void 0===m?1:parseInt(m);n.prop("checked",k).change(function(){k=this.checked?1:0;Cookies.set("pretty",this.checked?1:0,{expires:365})});h.submit(function(a){b=!0;d.addClass("floating uploading");c.text("");g.addClass("hidden");e.click(function(){return!1})});e.on("change",function(){var a;switch(this.files.length){case 0:a="";break;
case 1:a=this.files[0].name;break;default:a=this.files.length+" files selected"}b=!!a;a?(d.removeClass("floating"),c.text(a),g.removeClass("hidden")):(d.addClass("floating"),c.text(""),g.addClass("hidden"))});f.on("drag dragstart dragend dragover dragenter dragleave drop",function(a){a.preventDefault();a.stopPropagation()}).on("dragover dragenter",function(){b||f.addClass("dragging")}).on("dragleave dragend drop",function(){b||f.removeClass("dragging")}).on("drop",function(a){if(!b){b=a.originalEvent.dataTransfer.files;
a=new FormData;for(var l=0;l<b.length;l++)a.append("files[]",b[l]);d.addClass("floating uploading");c.text("");g.addClass("hidden");e.click(function(){return!1});$.ajax({url:h.attr("action"),type:h.attr("method"),data:a,dataType:"text",cache:!1,contentType:!1,processData:!1,success:function(a){b=!1;e.off("click");d.removeClass("uploading");var c=$("<form>",{method:"POST",action:"/"});$("<input>",{type:"hidden",name:"drop",value:a}).appendTo(c);$("<input>",{type:"hidden",name:"pretty",value:k}).appendTo(c);
c.appendTo(f).submit()},error:function(){b=!1;e.off("click");d.removeClass("uploading").addClass("error");setTimeout(function(){d.removeClass("error")},2E3)}})}})});
